// Copyright (c) 2022 F5, Inc. All rights reserved.
// Code generated by ves-gen-schema-go. DO NOT EDIT.

package app_security

import (
	"bytes"
	"context"
	"fmt"
	io "io"
	"net/http"
	"strings"

	"github.com/gogo/protobuf/proto"
	"github.com/grpc-ecosystem/grpc-gateway/runtime"
	"google.golang.org/grpc"

	"gopkg.volterra.us/stdlib/client"
	"gopkg.volterra.us/stdlib/codec"
	"gopkg.volterra.us/stdlib/errors"
	"gopkg.volterra.us/stdlib/server"
	"gopkg.volterra.us/stdlib/svcfw"
)

var (
	_ = fmt.Sprintf("dummy for fmt import use")
)

// Create OasValidationSuggestionAPI GRPC Client satisfying server.CustomClient
type OasValidationSuggestionAPIGrpcClient struct {
	conn       *grpc.ClientConn
	grpcClient OasValidationSuggestionAPIClient
	// map of rpc name to its invocation
	rpcFns map[string]func(context.Context, string, ...grpc.CallOption) (proto.Message, error)
}

func (c *OasValidationSuggestionAPIGrpcClient) doRPCGetSuggestedOasValidationRule(ctx context.Context, yamlReq string, opts ...grpc.CallOption) (proto.Message, error) {
	req := &GetSuggestedOasValidationRuleReq{}
	if err := codec.FromYAML(yamlReq, req); err != nil {
		return nil, fmt.Errorf("YAML Request %s is not of type *ves.io.schema.app_security.GetSuggestedOasValidationRuleReq", yamlReq)
	}
	rsp, err := c.grpcClient.GetSuggestedOasValidationRule(ctx, req, opts...)
	return rsp, err
}

func (c *OasValidationSuggestionAPIGrpcClient) DoRPC(ctx context.Context, rpc string, opts ...server.CustomCallOpt) (proto.Message, error) {
	rpcFn, exists := c.rpcFns[rpc]
	if !exists {
		return nil, fmt.Errorf("Error, no such rpc %s", rpc)
	}
	cco := server.NewCustomCallOpts()
	for _, opt := range opts {
		opt(cco)
	}
	if cco.YAMLReq == "" {
		return nil, fmt.Errorf("Error, empty request body")
	}
	ctx = client.AddHdrsToCtx(cco.Headers, ctx)

	rsp, err := rpcFn(ctx, cco.YAMLReq, cco.GrpcCallOpts...)
	if err != nil {
		return nil, errors.Wrap(err, "Doing custom RPC using GRPC")
	}
	if cco.OutCallResponse != nil {
		cco.OutCallResponse.ProtoMsg = rsp
	}
	return rsp, nil
}

func NewOasValidationSuggestionAPIGrpcClient(cc *grpc.ClientConn) server.CustomClient {
	ccl := &OasValidationSuggestionAPIGrpcClient{
		conn:       cc,
		grpcClient: NewOasValidationSuggestionAPIClient(cc),
	}
	rpcFns := make(map[string]func(context.Context, string, ...grpc.CallOption) (proto.Message, error))
	rpcFns["GetSuggestedOasValidationRule"] = ccl.doRPCGetSuggestedOasValidationRule

	ccl.rpcFns = rpcFns

	return ccl
}

// Create OasValidationSuggestionAPI REST Client satisfying server.CustomClient
type OasValidationSuggestionAPIRestClient struct {
	baseURL string
	client  http.Client
	// map of rpc name to its invocation
	rpcFns map[string]func(context.Context, *server.CustomCallOpts) (proto.Message, error)
}

func (c *OasValidationSuggestionAPIRestClient) doRPCGetSuggestedOasValidationRule(ctx context.Context, callOpts *server.CustomCallOpts) (proto.Message, error) {
	if callOpts.URI == "" {
		return nil, fmt.Errorf("Error, URI should be specified, got empty")
	}
	url := fmt.Sprintf("%s%s", c.baseURL, callOpts.URI)

	yamlReq := callOpts.YAMLReq
	req := &GetSuggestedOasValidationRuleReq{}
	if err := codec.FromYAML(yamlReq, req); err != nil {
		return nil, fmt.Errorf("YAML Request %s is not of type *ves.io.schema.app_security.GetSuggestedOasValidationRuleReq: %s", yamlReq, err)
	}

	var hReq *http.Request
	hm := strings.ToLower(callOpts.HTTPMethod)
	switch hm {
	case "post", "put":
		jsn, err := codec.ToJSON(req, codec.ToWithUseProtoFieldName())
		if err != nil {
			return nil, errors.Wrap(err, "Custom RestClient converting YAML to JSON")
		}
		var op string
		if hm == "post" {
			op = http.MethodPost
		} else {
			op = http.MethodPut
		}
		newReq, err := http.NewRequest(op, url, bytes.NewBuffer([]byte(jsn)))
		if err != nil {
			return nil, errors.Wrapf(err, "Creating new HTTP %s request for custom API", op)
		}
		hReq = newReq
	case "get":
		newReq, err := http.NewRequest(http.MethodGet, url, nil)
		if err != nil {
			return nil, errors.Wrap(err, "Creating new HTTP GET request for custom API")
		}
		hReq = newReq
		q := hReq.URL.Query()
		_ = q
		for _, item := range req.ApiGroups {
			q.Add("api_groups", fmt.Sprintf("%v", item))
		}
		q.Add("method", fmt.Sprintf("%v", req.Method))
		q.Add("name", fmt.Sprintf("%v", req.Name))
		q.Add("namespace", fmt.Sprintf("%v", req.Namespace))
		q.Add("path", fmt.Sprintf("%v", req.Path))

		hReq.URL.RawQuery += q.Encode()
	case "delete":
		newReq, err := http.NewRequest(http.MethodDelete, url, nil)
		if err != nil {
			return nil, errors.Wrap(err, "Creating new HTTP DELETE request for custom API")
		}
		hReq = newReq
	default:
		return nil, fmt.Errorf("Error, invalid/empty HTTPMethod(%s) specified, should be POST|DELETE|GET", callOpts.HTTPMethod)
	}
	hReq = hReq.WithContext(ctx)
	hReq.Header.Set("Content-Type", "application/json")
	client.AddHdrsToReq(callOpts.Headers, hReq)

	rsp, err := c.client.Do(hReq)
	if err != nil {
		return nil, errors.Wrap(err, "Custom API RestClient")
	}
	defer rsp.Body.Close()

	// checking whether the status code is a successful status code (2xx series)
	if rsp.StatusCode < 200 || rsp.StatusCode > 299 {
		body, err := io.ReadAll(rsp.Body)
		return nil, fmt.Errorf("Unsuccessful custom API %s on %s, status code %d, body %s, err %s", callOpts.HTTPMethod, callOpts.URI, rsp.StatusCode, body, err)
	}

	body, err := io.ReadAll(rsp.Body)
	if err != nil {
		return nil, errors.Wrap(err, "Custom API RestClient read body")
	}
	pbRsp := &GetSuggestedOasValidationRuleRsp{}
	if err := codec.FromJSON(string(body), pbRsp); err != nil {
		return nil, errors.Wrapf(err, "JSON Response %s is not of type *ves.io.schema.app_security.GetSuggestedOasValidationRuleRsp", body)

	}
	if callOpts.OutCallResponse != nil {
		callOpts.OutCallResponse.ProtoMsg = pbRsp
		callOpts.OutCallResponse.JSON = string(body)
	}
	return pbRsp, nil
}

func (c *OasValidationSuggestionAPIRestClient) DoRPC(ctx context.Context, rpc string, opts ...server.CustomCallOpt) (proto.Message, error) {
	rpcFn, exists := c.rpcFns[rpc]
	if !exists {
		return nil, fmt.Errorf("Error, no such rpc %s", rpc)
	}
	cco := server.NewCustomCallOpts()
	for _, opt := range opts {
		opt(cco)
	}

	rsp, err := rpcFn(ctx, cco)
	if err != nil {
		return nil, errors.Wrap(err, "Doing custom RPC using Rest")
	}
	return rsp, nil
}

func NewOasValidationSuggestionAPIRestClient(baseURL string, hc http.Client) server.CustomClient {
	ccl := &OasValidationSuggestionAPIRestClient{
		baseURL: baseURL,
		client:  hc,
	}

	rpcFns := make(map[string]func(context.Context, *server.CustomCallOpts) (proto.Message, error))
	rpcFns["GetSuggestedOasValidationRule"] = ccl.doRPCGetSuggestedOasValidationRule

	ccl.rpcFns = rpcFns

	return ccl
}

// Create oasValidationSuggestionAPIInprocClient

// INPROC Client (satisfying OasValidationSuggestionAPIClient interface)
type oasValidationSuggestionAPIInprocClient struct {
	OasValidationSuggestionAPIServer
}

func (c *oasValidationSuggestionAPIInprocClient) GetSuggestedOasValidationRule(ctx context.Context, in *GetSuggestedOasValidationRuleReq, opts ...grpc.CallOption) (*GetSuggestedOasValidationRuleRsp, error) {
	ctx = server.ContextWithRpcFQN(ctx, "ves.io.schema.app_security.OasValidationSuggestionAPI.GetSuggestedOasValidationRule")
	return c.OasValidationSuggestionAPIServer.GetSuggestedOasValidationRule(ctx, in)
}

func NewOasValidationSuggestionAPIInprocClient(svc svcfw.Service) OasValidationSuggestionAPIClient {
	return &oasValidationSuggestionAPIInprocClient{OasValidationSuggestionAPIServer: NewOasValidationSuggestionAPIServer(svc)}
}

// RegisterGwOasValidationSuggestionAPIHandler registers with grpc-gw with an inproc-client backing so that
// rest to grpc happens without a grpc.Dial (thus avoiding additional certs for mTLS)
func RegisterGwOasValidationSuggestionAPIHandler(ctx context.Context, mux *runtime.ServeMux, svc interface{}) error {
	s, ok := svc.(svcfw.Service)
	if !ok {
		return fmt.Errorf("svc is not svcfw.Service")
	}
	return RegisterOasValidationSuggestionAPIHandlerClient(ctx, mux, NewOasValidationSuggestionAPIInprocClient(s))
}

// Create oasValidationSuggestionAPISrv

// SERVER (satisfying OasValidationSuggestionAPIServer interface)
type oasValidationSuggestionAPISrv struct {
	svc svcfw.Service
}

func (s *oasValidationSuggestionAPISrv) GetSuggestedOasValidationRule(ctx context.Context, in *GetSuggestedOasValidationRuleReq) (*GetSuggestedOasValidationRuleRsp, error) {
	ah := s.svc.GetAPIHandler("ves.io.schema.app_security.OasValidationSuggestionAPI")
	cah, ok := ah.(OasValidationSuggestionAPIServer)
	if !ok {
		return nil, fmt.Errorf("ah %v is not of type *OasValidationSuggestionAPIServer", ah)
	}

	var (
		rsp *GetSuggestedOasValidationRuleRsp
		err error
	)

	bodyFields := svcfw.GenAuditReqBodyFields(ctx, s.svc, "ves.io.schema.app_security.GetSuggestedOasValidationRuleReq", in)
	defer func() {
		if len(bodyFields) > 0 {
			server.ExtendAPIAudit(ctx, svcfw.PublicAPIBodyLog.Uid, bodyFields)
		}
		userMsg := "The 'OasValidationSuggestionAPI.GetSuggestedOasValidationRule' operation on 'app_security'"
		if err == nil {
			userMsg += " was successfully performed."
		} else {
			userMsg += " failed to be performed."
		}
		server.AddUserMsgToAPIAudit(ctx, userMsg)
	}()

	if err := svcfw.FillOneofDefaultChoice(ctx, s.svc, in); err != nil {
		err = server.MaybePublicRestError(ctx, errors.Wrapf(err, "Filling oneof default choice"))
		return nil, server.GRPCStatusFromError(err).Err()
	}

	if s.svc.Config().EnableAPIValidation {
		if rvFn := s.svc.GetRPCValidator("ves.io.schema.app_security.OasValidationSuggestionAPI.GetSuggestedOasValidationRule"); rvFn != nil {
			if verr := rvFn(ctx, in); verr != nil {
				err = server.MaybePublicRestError(ctx, errors.Wrapf(verr, "Validating Request"))
				return nil, server.GRPCStatusFromError(err).Err()
			}
		}
	}

	rsp, err = cah.GetSuggestedOasValidationRule(ctx, in)
	if err != nil {
		return rsp, server.GRPCStatusFromError(server.MaybePublicRestError(ctx, err)).Err()
	}

	bodyFields = append(bodyFields, svcfw.GenAuditRspBodyFields(ctx, s.svc, "ves.io.schema.app_security.GetSuggestedOasValidationRuleRsp", rsp)...)

	return rsp, nil
}

func NewOasValidationSuggestionAPIServer(svc svcfw.Service) OasValidationSuggestionAPIServer {
	return &oasValidationSuggestionAPISrv{svc: svc}
}

var OasValidationSuggestionAPISwaggerJSON string = `{
    "swagger": "2.0",
    "info": {
        "title": "Application Security Monitoring APIs",
        "description": "API to create Open API specification validation rule suggestion from App Security Monitoring pages",
        "version": "version not set"
    },
    "schemes": [
        "http",
        "https"
    ],
    "consumes": [
        "application/json"
    ],
    "produces": [
        "application/json"
    ],
    "tags": [],
    "paths": {
        "/public/namespaces/{namespace}/http_loadbalancers/{name}/oas_validation/suggestion": {
            "post": {
                "summary": "Suggest Open API specification validation rule",
                "description": "Suggest Open API specification validation rule for a given path\nDEPRECATED. Use api_sec.rule_suggestion.RuleSuggestionAPI.GetSuggestedOasValidationRule",
                "operationId": "ves.io.schema.app_security.OasValidationSuggestionAPI.GetSuggestedOasValidationRule",
                "responses": {
                    "200": {
                        "description": "A successful response.",
                        "schema": {
                            "$ref": "#/definitions/app_securityGetSuggestedOasValidationRuleRsp"
                        }
                    },
                    "401": {
                        "description": "Returned when operation is not authorized",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "403": {
                        "description": "Returned when there is no permission to access resource",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "404": {
                        "description": "Returned when resource is not found",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "409": {
                        "description": "Returned when operation on resource is conflicting with current value",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "429": {
                        "description": "Returned when operation has been rejected as it is happening too frequently",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "500": {
                        "description": "Returned when server encountered an error in processing API",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "503": {
                        "description": "Returned when service is unavailable temporarily",
                        "schema": {
                            "format": "string"
                        }
                    },
                    "504": {
                        "description": "Returned when server timed out processing request",
                        "schema": {
                            "format": "string"
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "namespace",
                        "description": "Namespace\n\nx-example: \"shared\"\nNamespace of the App type for current request",
                        "in": "path",
                        "required": true,
                        "type": "string",
                        "x-displayname": "Namespace"
                    },
                    {
                        "name": "name",
                        "description": "Name\n\nx-example: \"ves-io-frontend\"\nHTTP load balancer for which this Open API specification validation rule applied",
                        "in": "path",
                        "required": true,
                        "type": "string",
                        "x-displayname": "HTTP Load Balancer Name"
                    },
                    {
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/app_securityGetSuggestedOasValidationRuleReq"
                        }
                    }
                ],
                "tags": [
                    "OasValidationSuggestionAPI"
                ],
                "externalDocs": {
                    "description": "Examples of this operation",
                    "url": "https://docs.cloud.f5.com/docs-v2/platform/reference/api-ref/ves-io-schema-app_security-oasvalidationsuggestionapi-getsuggestedoasvalidationrule"
                },
                "x-ves-deprecated": "Use GetSuggestedOasValidationRule in RuleSuggestionAPI",
                "x-ves-proto-rpc": "ves.io.schema.app_security.OasValidationSuggestionAPI.GetSuggestedOasValidationRule"
            },
            "x-displayname": "Open API specification validation Rule Suggestion API",
            "x-ves-proto-service": "ves.io.schema.app_security.OasValidationSuggestionAPI",
            "x-ves-proto-service-type": "CUSTOM_PUBLIC"
        }
    },
    "definitions": {
        "app_securityGetSuggestedOasValidationRuleReq": {
            "type": "object",
            "description": "Get suggested Open API specification validation for a given path",
            "title": "GetSuggestedOasValidationRuleReq",
            "x-displayname": "Get Suggested Open API specification validation Rule Request",
            "x-ves-proto-message": "ves.io.schema.app_security.GetSuggestedOasValidationRuleReq",
            "properties": {
                "api_groups": {
                    "type": "array",
                    "description": " List of API Groups the API Endpoint is a member of.\n\nExample: - [\"group-1\", \"group-2\"]-",
                    "title": "API Groups membership",
                    "items": {
                        "type": "string"
                    },
                    "x-displayname": "API Groups membership"
                },
                "method": {
                    "description": " Method to apply the Open API specification validation to\n\nExample: - \"POST\"-\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.enum.defined_only: true\n  ves.io.schema.rules.message.required: true\n",
                    "title": "Method",
                    "$ref": "#/definitions/schemaHttpMethod",
                    "x-displayname": "Request Method",
                    "x-ves-example": "POST",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.enum.defined_only": "true",
                        "ves.io.schema.rules.message.required": "true"
                    }
                },
                "name": {
                    "type": "string",
                    "description": " HTTP load balancer for which this Open API specification validation rule applied\n\nExample: - \"ves-io-frontend\"-",
                    "title": "Name",
                    "x-displayname": "HTTP Load Balancer Name",
                    "x-ves-example": "ves-io-frontend"
                },
                "namespace": {
                    "type": "string",
                    "description": " Namespace of the App type for current request\n\nExample: - \"shared\"-",
                    "title": "Namespace",
                    "x-displayname": "Namespace",
                    "x-ves-example": "shared"
                },
                "path": {
                    "type": "string",
                    "description": " Path to apply the Open API specification validation to\n\nExample: - \"/example\"-\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.string.max_len: 1024\n  ves.io.schema.rules.string.templated_http_path: true\n",
                    "title": "Path",
                    "maxLength": 1024,
                    "x-displayname": "Request Path",
                    "x-ves-example": "/example",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.string.max_len": "1024",
                        "ves.io.schema.rules.string.templated_http_path": "true"
                    }
                }
            }
        },
        "app_securityGetSuggestedOasValidationRuleRsp": {
            "type": "object",
            "description": "Get suggested Open API specification validation for a given path",
            "title": "GetSuggestedOasValidationRuleRsp",
            "x-displayname": "Get Suggested Open API specification validation Rule Response",
            "x-ves-oneof-field-api_validation_choice": "[\"all_endpoints_oas_validation\",\"custom_oas_validation\"]",
            "x-ves-proto-message": "ves.io.schema.app_security.GetSuggestedOasValidationRuleRsp",
            "properties": {
                "all_endpoints_oas_validation": {
                    "description": "Exclusive with [custom_oas_validation]\n",
                    "$ref": "#/definitions/common_wafOpenApiValidationAllSpecEndpointsSettings"
                },
                "custom_oas_validation": {
                    "description": "Exclusive with [all_endpoints_oas_validation]\n",
                    "$ref": "#/definitions/common_wafOpenApiValidationRule"
                },
                "found_existing_rule": {
                    "description": " Specifies if an existing rule to block this client already exists with same match conditions",
                    "title": "FoundExistingRule",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Found existing rule"
                }
            }
        },
        "common_wafApiEndpointDetails": {
            "type": "object",
            "description": "This defines api endpoint",
            "title": "ApiEndpointDetails",
            "x-displayname": "API Endpoint",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.ApiEndpointDetails",
            "properties": {
                "methods": {
                    "type": "array",
                    "description": " Methods to be matched\n\nExample: - \"GET\"-\n\nValidation Rules:\n  ves.io.schema.rules.repeated.items.enum.defined_only: true\n  ves.io.schema.rules.repeated.max_items: 16\n  ves.io.schema.rules.repeated.unique: true\n",
                    "title": "Methods",
                    "maxItems": 16,
                    "items": {
                        "$ref": "#/definitions/schemaHttpMethod"
                    },
                    "x-displayname": "Methods",
                    "x-ves-example": "GET",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.repeated.items.enum.defined_only": "true",
                        "ves.io.schema.rules.repeated.max_items": "16",
                        "ves.io.schema.rules.repeated.unique": "true"
                    }
                },
                "path": {
                    "type": "string",
                    "description": " Path to be matched\n\nExample: - \"/api/v1/login\"-\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.string.max_len: 1024\n  ves.io.schema.rules.string.templated_http_path: true\n",
                    "title": "Path",
                    "maxLength": 1024,
                    "x-displayname": "Path",
                    "x-ves-example": "/api/v1/login",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.string.max_len": "1024",
                        "ves.io.schema.rules.string.templated_http_path": "true"
                    }
                }
            }
        },
        "common_wafCustomFallThroughMode": {
            "type": "object",
            "description": "Define the fall through settings",
            "title": "Custom Fall Through Mode",
            "x-displayname": "Custom Fall Through Mode",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.CustomFallThroughMode",
            "properties": {
                "open_api_validation_rules": {
                    "type": "array",
                    "description": "\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.repeated.max_items: 15\n  ves.io.schema.rules.repeated.unique_metadata_name: true\n",
                    "title": "Custom Fall Through Rule List",
                    "maxItems": 15,
                    "items": {
                        "$ref": "#/definitions/common_wafFallThroughRule"
                    },
                    "x-displayname": "Custom Fall Through Rule List",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.repeated.max_items": "15",
                        "ves.io.schema.rules.repeated.unique_metadata_name": "true"
                    }
                }
            }
        },
        "common_wafFallThroughRule": {
            "type": "object",
            "description": "Fall Through Rule for a specific endpoint, base-path, or API group",
            "title": "Fall Through Rule",
            "x-displayname": "Fall Through Rule",
            "x-ves-oneof-field-action_choice": "[\"action_block\",\"action_report\",\"action_skip\"]",
            "x-ves-oneof-field-condition_type_choice": "[\"api_endpoint\",\"api_group\",\"base_path\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.FallThroughRule",
            "properties": {
                "action_block": {
                    "description": "Exclusive with [action_report action_skip]\n Block the request and issue an API security event",
                    "title": "block",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Block"
                },
                "action_report": {
                    "description": "Exclusive with [action_block action_skip]\n Continue processing the request and issue an API security event",
                    "title": "report",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Report"
                },
                "action_skip": {
                    "description": "Exclusive with [action_block action_report]\n Continue processing the request",
                    "title": "skip",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Skip"
                },
                "api_endpoint": {
                    "description": "Exclusive with [api_group base_path]\n The API endpoint (Path + Method) which this validation applies to",
                    "title": "API Endpoint",
                    "$ref": "#/definitions/common_wafApiEndpointDetails",
                    "x-displayname": "API Endpoint"
                },
                "api_group": {
                    "type": "string",
                    "description": "Exclusive with [api_endpoint base_path]\n The API group which this validation applies to\n\nExample: - \"oas-all-operations\"-\n\nValidation Rules:\n  ves.io.schema.rules.string.max_len: 128\n",
                    "title": "api_group",
                    "maxLength": 128,
                    "x-displayname": "API Group",
                    "x-ves-example": "oas-all-operations",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.max_len": "128"
                    }
                },
                "base_path": {
                    "type": "string",
                    "description": "Exclusive with [api_endpoint api_group]\n The base path which this validation applies to\n\nExample: - \"/api/v1\"-\n\nValidation Rules:\n  ves.io.schema.rules.string.http_path: true\n  ves.io.schema.rules.string.max_len: 128\n",
                    "title": "base path",
                    "maxLength": 128,
                    "x-displayname": "Base Path",
                    "x-ves-example": "/api/v1",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.http_path": "true",
                        "ves.io.schema.rules.string.max_len": "128"
                    }
                },
                "metadata": {
                    "description": " Common attributes for the rule including name and description.\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n",
                    "title": "metadata",
                    "$ref": "#/definitions/schemaMessageMetaType",
                    "x-displayname": "Metadata",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true"
                    }
                }
            }
        },
        "common_wafOpenApiFallThroughMode": {
            "type": "object",
            "description": "x-required\nDetermine what to do with unprotected endpoints (not in the OpenAPI specification file (a.k.a. swagger) or doesn't have a specific rule in custom rules)",
            "title": "Fall Through Mode",
            "x-displayname": "Fall Through Mode",
            "x-ves-oneof-field-fall_through_mode_choice": "[\"fall_through_mode_allow\",\"fall_through_mode_custom\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiFallThroughMode",
            "properties": {
                "fall_through_mode_allow": {
                    "description": "Exclusive with [fall_through_mode_custom]\n Allow any unprotected end point",
                    "title": "Allow",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Allow"
                },
                "fall_through_mode_custom": {
                    "description": "Exclusive with [fall_through_mode_allow]\n Custom rules for any unprotected end point",
                    "title": "Custom",
                    "$ref": "#/definitions/common_wafCustomFallThroughMode",
                    "x-displayname": "Custom"
                }
            }
        },
        "common_wafOpenApiValidationAllSpecEndpointsSettings": {
            "type": "object",
            "description": "Settings for API Inventory validation",
            "title": "OpenAPI Validation API Inventory Settings",
            "x-displayname": "API Inventory",
            "x-ves-oneof-field-oversized_body_choice": "[]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationAllSpecEndpointsSettings",
            "properties": {
                "fall_through_mode": {
                    "description": " Determine what to do with unprotected endpoints (not part of the API Inventory or doesn't have a specific rule in custom rules)\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n",
                    "title": "Fall Through Mode",
                    "$ref": "#/definitions/common_wafOpenApiFallThroughMode",
                    "x-displayname": "Fall Through Mode",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true"
                    }
                },
                "settings": {
                    "description": " OpenAPI specification validation settings relevant for \"API Inventory\" enforcement and for \"Custom list\" enforcement",
                    "title": "OpenAPI specification validation common settings",
                    "$ref": "#/definitions/common_wafOpenApiValidationCommonSettings",
                    "x-displayname": "Common Settings"
                },
                "validation_mode": {
                    "description": " Validation mode of OpenAPI specification.\n  When a validation mismatch occurs on a request to one of the API Inventory endpoints\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n",
                    "title": "Validation Mode",
                    "$ref": "#/definitions/common_wafOpenApiValidationMode",
                    "x-displayname": "Validation Mode",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true"
                    }
                }
            }
        },
        "common_wafOpenApiValidationCommonSettings": {
            "type": "object",
            "description": "OpenAPI specification validation settings relevant for \"API Inventory\" enforcement and for \"Custom list\" enforcement",
            "title": "OpenAPI specification validation common settings",
            "x-displayname": "Common Settings",
            "x-ves-oneof-field-fail_configuration": "[]",
            "x-ves-oneof-field-oversized_body_choice": "[\"oversized_body_fail_validation\",\"oversized_body_skip_validation\"]",
            "x-ves-oneof-field-property_validation_settings_choice": "[\"property_validation_settings_custom\",\"property_validation_settings_default\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationCommonSettings",
            "properties": {
                "oversized_body_fail_validation": {
                    "description": "Exclusive with [oversized_body_skip_validation]\n Apply the request/response action (block or report) when the body length is too long to verify (default 64Kb)",
                    "title": "Fail the validation for over-sized body",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Fail Body Validation"
                },
                "oversized_body_skip_validation": {
                    "description": "Exclusive with [oversized_body_fail_validation]\n Skip body validation when the body length is too long to verify (default 64Kb)",
                    "title": "Skip validation for over-sized body",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Skip Body Validation"
                },
                "property_validation_settings_custom": {
                    "description": "Exclusive with [property_validation_settings_default]\n Use custom settings with Open API specification validation",
                    "title": "Custom settings",
                    "$ref": "#/definitions/common_wafValidationPropertySetting",
                    "x-displayname": "Custom"
                },
                "property_validation_settings_default": {
                    "description": "Exclusive with [property_validation_settings_custom]\n Keep the default settings of OpenAPI specification validation",
                    "title": "Default",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Default"
                }
            }
        },
        "common_wafOpenApiValidationMode": {
            "type": "object",
            "description": "x-required\nValidation mode of OpenAPI specification.\n When a validation mismatch occurs on a request to one of the endpoints listed on the OpenAPI specification file (a.k.a. swagger)",
            "title": "Validation Mode",
            "x-displayname": "Validation Mode",
            "x-ves-oneof-field-response_validation_mode_choice": "[\"response_validation_mode_active\",\"skip_response_validation\"]",
            "x-ves-oneof-field-validation_mode_choice": "[\"skip_validation\",\"validation_mode_active\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationMode",
            "properties": {
                "response_validation_mode_active": {
                    "description": "Exclusive with [skip_response_validation]\n Enforce OpenAPI validation processing for this event",
                    "title": "Validate",
                    "$ref": "#/definitions/common_wafOpenApiValidationModeActiveResponse",
                    "x-displayname": "Validate"
                },
                "skip_response_validation": {
                    "description": "Exclusive with [response_validation_mode_active]\n Skip OpenAPI validation processing for this event",
                    "title": "Skip",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Skip"
                },
                "skip_validation": {
                    "description": "Exclusive with [validation_mode_active]\n Skip OpenAPI validation processing for this event",
                    "title": "Skip",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Skip"
                },
                "validation_mode_active": {
                    "description": "Exclusive with [skip_validation]\n Enforce OpenAPI validation processing for this event",
                    "title": "Validate",
                    "$ref": "#/definitions/common_wafOpenApiValidationModeActive",
                    "x-displayname": "Validate"
                }
            }
        },
        "common_wafOpenApiValidationModeActive": {
            "type": "object",
            "description": "Validation mode properties of request",
            "title": "Open API Validation Mode Active For Request",
            "x-displayname": "Open API Validation Mode Active",
            "x-ves-oneof-field-validation_enforcement_type": "[\"enforcement_block\",\"enforcement_report\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationModeActive",
            "properties": {
                "enforcement_block": {
                    "description": "Exclusive with [enforcement_report]\n Block the request, trigger an API security event",
                    "title": "Block",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Block"
                },
                "enforcement_report": {
                    "description": "Exclusive with [enforcement_block]\n Allow the request, trigger an API security event",
                    "title": "Report",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Report"
                },
                "request_validation_properties": {
                    "type": "array",
                    "description": " List of properties of the request to validate according to the OpenAPI specification file (a.k.a. swagger)\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.repeated.items.enum.defined_only: true\n  ves.io.schema.rules.repeated.items.enum.not_in: [7]\n  ves.io.schema.rules.repeated.min_items: 1\n  ves.io.schema.rules.repeated.unique: true\n",
                    "title": "Request Validation Properties",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/schemaOpenApiValidationProperties"
                    },
                    "x-displayname": "Request Validation Properties",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.repeated.items.enum.defined_only": "true",
                        "ves.io.schema.rules.repeated.items.enum.not_in": "[7]",
                        "ves.io.schema.rules.repeated.min_items": "1",
                        "ves.io.schema.rules.repeated.unique": "true"
                    }
                }
            }
        },
        "common_wafOpenApiValidationModeActiveResponse": {
            "type": "object",
            "description": "Validation mode properties of response",
            "title": "Open API Validation Mode Active For Response",
            "x-displayname": "Open API Validation Mode Active",
            "x-ves-oneof-field-validation_enforcement_type": "[\"enforcement_block\",\"enforcement_report\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationModeActiveResponse",
            "properties": {
                "enforcement_block": {
                    "description": "Exclusive with [enforcement_report]\n Block the response, trigger an API security event",
                    "title": "Block",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Block"
                },
                "enforcement_report": {
                    "description": "Exclusive with [enforcement_block]\n Allow the response, trigger an API security event",
                    "title": "Report",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Report"
                },
                "response_validation_properties": {
                    "type": "array",
                    "description": " List of properties of the response to validate according to the OpenAPI specification file (a.k.a. swagger)\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.repeated.items.enum.defined_only: true\n  ves.io.schema.rules.repeated.items.enum.in: [2,4,5,7]\n  ves.io.schema.rules.repeated.min_items: 1\n  ves.io.schema.rules.repeated.unique: true\n",
                    "title": "Response Validation Properties",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/schemaOpenApiValidationProperties"
                    },
                    "x-displayname": "Response Validation Properties",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.repeated.items.enum.defined_only": "true",
                        "ves.io.schema.rules.repeated.items.enum.in": "[2,4,5,7]",
                        "ves.io.schema.rules.repeated.min_items": "1",
                        "ves.io.schema.rules.repeated.unique": "true"
                    }
                }
            }
        },
        "common_wafOpenApiValidationRule": {
            "type": "object",
            "description": "OpenAPI Validation Rule for a specific endpoint, base-path, or API group",
            "title": "OpenAPI Validation Rule",
            "x-displayname": "OpenAPI Validation Rule",
            "x-ves-oneof-field-condition_type_choice": "[\"api_endpoint\",\"api_group\",\"base_path\"]",
            "x-ves-oneof-field-domain_choice": "[\"any_domain\",\"specific_domain\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.OpenApiValidationRule",
            "properties": {
                "any_domain": {
                    "description": "Exclusive with [specific_domain]\n The rule will apply for all domains.",
                    "title": "any domain",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Any Domain"
                },
                "api_endpoint": {
                    "description": "Exclusive with [api_group base_path]\n The API endpoint (Path + Method) which this validation applies to",
                    "title": "API Endpoint",
                    "$ref": "#/definitions/common_wafApiEndpointDetails",
                    "x-displayname": "API Endpoint"
                },
                "api_group": {
                    "type": "string",
                    "description": "Exclusive with [api_endpoint base_path]\n The API group which this validation applies to\n\nExample: - \"oas-all-operations\"-\n\nValidation Rules:\n  ves.io.schema.rules.string.max_len: 128\n",
                    "title": "api_group",
                    "maxLength": 128,
                    "x-displayname": "API Group",
                    "x-ves-example": "oas-all-operations",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.max_len": "128"
                    }
                },
                "base_path": {
                    "type": "string",
                    "description": "Exclusive with [api_endpoint api_group]\n The base path which this validation applies to\n\nExample: - \"/api/v1\"-\n\nValidation Rules:\n  ves.io.schema.rules.string.http_path: true\n  ves.io.schema.rules.string.max_len: 128\n",
                    "title": "base path",
                    "maxLength": 128,
                    "x-displayname": "Base Path",
                    "x-ves-example": "/api/v1",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.http_path": "true",
                        "ves.io.schema.rules.string.max_len": "128"
                    }
                },
                "metadata": {
                    "description": " Common attributes for the rule including name and description.\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n",
                    "title": "metadata",
                    "$ref": "#/definitions/schemaMessageMetaType",
                    "x-displayname": "Metadata",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true"
                    }
                },
                "specific_domain": {
                    "type": "string",
                    "description": "Exclusive with [any_domain]\n The rule will apply for a specific domain.\n\nValidation Rules:\n  ves.io.schema.rules.string.max_len: 128\n  ves.io.schema.rules.string.vh_domain: true\n",
                    "title": "domain",
                    "maxLength": 128,
                    "x-displayname": "Specific Domain",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.max_len": "128",
                        "ves.io.schema.rules.string.vh_domain": "true"
                    }
                },
                "validation_mode": {
                    "description": " Validation mode of OpenAPI specification.\n  When a validation mismatch occurs on a request to one of the endpoints listed on the OpenAPI specification file (a.k.a. swagger)\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n",
                    "title": "Validation Mode",
                    "$ref": "#/definitions/common_wafOpenApiValidationMode",
                    "x-displayname": "Validation Mode",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true"
                    }
                }
            }
        },
        "common_wafValidationPropertySetting": {
            "type": "object",
            "description": "Custom property validation settings",
            "title": "Validation Property settings",
            "x-displayname": "Validation Property Settings",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.ValidationPropertySetting",
            "properties": {
                "queryParameters": {
                    "description": " Custom settings for query parameters validation",
                    "title": "Query parameters validation settings",
                    "$ref": "#/definitions/common_wafValidationSettingForQueryParameters",
                    "x-displayname": "Validation Settings For Query Parameters"
                }
            }
        },
        "common_wafValidationSettingForHeaders": {
            "type": "object",
            "description": "x-displayName: \"Validation Settings For Headers\"\nCustom settings for headers validation",
            "title": "Validation Settings For Headers",
            "properties": {
                "allow_additional_headers": {
                    "description": "x-displayName: \"Allow\"\nAllow extra headers (on top of what specified in the OAS documentation)",
                    "title": "Allow",
                    "$ref": "#/definitions/schemaEmpty"
                },
                "disallow_additional_headers": {
                    "description": "x-displayName: \"Disallow\"\nDisallow extra headers (on top of what specified in the OAS documentation)",
                    "title": "Custom settings",
                    "$ref": "#/definitions/schemaEmpty"
                }
            }
        },
        "common_wafValidationSettingForQueryParameters": {
            "type": "object",
            "description": "Custom settings for query parameters validation",
            "title": "Validation Settings For Query Parameters",
            "x-displayname": "Validation Settings For Query Parameters",
            "x-ves-oneof-field-additional_parameters_choice": "[\"allow_additional_parameters\",\"disallow_additional_parameters\"]",
            "x-ves-proto-message": "ves.io.schema.views.common_waf.ValidationSettingForQueryParameters",
            "properties": {
                "allow_additional_parameters": {
                    "description": "Exclusive with [disallow_additional_parameters]\n Allow extra query parameters (on top of what specified in the OAS documentation)",
                    "title": "Allow",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Allow"
                },
                "disallow_additional_parameters": {
                    "description": "Exclusive with [allow_additional_parameters]\n Disallow extra query parameters (on top of what specified in the OAS documentation)",
                    "title": "Custom settings",
                    "$ref": "#/definitions/schemaEmpty",
                    "x-displayname": "Disallow"
                }
            }
        },
        "schemaEmpty": {
            "type": "object",
            "description": "This can be used for messages where no values are needed",
            "title": "Empty",
            "x-displayname": "Empty",
            "x-ves-proto-message": "ves.io.schema.Empty"
        },
        "schemaHttpMethod": {
            "type": "string",
            "description": "Specifies the HTTP method used to access a resource.\n\nAny HTTP Method",
            "title": "HttpMethod",
            "enum": [
                "ANY",
                "GET",
                "HEAD",
                "POST",
                "PUT",
                "DELETE",
                "CONNECT",
                "OPTIONS",
                "TRACE",
                "PATCH",
                "COPY"
            ],
            "default": "ANY",
            "x-displayname": "HTTP Method",
            "x-ves-proto-enum": "ves.io.schema.HttpMethod"
        },
        "schemaMessageMetaType": {
            "type": "object",
            "description": "MessageMetaType is metadata (common attributes) of a message that only certain messages\nhave. This information is propagated to the metadata of a child object that gets created\nfrom the containing message during view processing.\nThe information in this type can be specified by user during create and replace APIs.",
            "title": "MessageMetaType",
            "x-displayname": "Message Metadata",
            "x-ves-proto-message": "ves.io.schema.MessageMetaType",
            "properties": {
                "description": {
                    "type": "string",
                    "description": " Human readable description.\n\nExample: - \"Virtual Host for acmecorp website\"-\n\nValidation Rules:\n  ves.io.schema.rules.string.max_len: 256\n",
                    "title": "description",
                    "maxLength": 256,
                    "x-displayname": "Description",
                    "x-ves-example": "Virtual Host for acmecorp website",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.string.max_len": "256"
                    }
                },
                "name": {
                    "type": "string",
                    "description": " This is the name of the message.\n The value of name has to follow DNS-1035 format.\n\nExample: - \"acmecorp-web\"-\n\nRequired: YES\n\nValidation Rules:\n  ves.io.schema.rules.message.required: true\n  ves.io.schema.rules.string.min_len: 1\n  ves.io.schema.rules.string.ves_object_name: true\n",
                    "title": "name",
                    "minLength": 1,
                    "x-displayname": "Name",
                    "x-ves-example": "acmecorp-web",
                    "x-ves-required": "true",
                    "x-ves-validation-rules": {
                        "ves.io.schema.rules.message.required": "true",
                        "ves.io.schema.rules.string.min_len": "1",
                        "ves.io.schema.rules.string.ves_object_name": "true"
                    }
                }
            }
        },
        "schemaOpenApiValidationProperties": {
            "type": "string",
            "description": "List of required properties to validate against the OpenAPI spec\n\nValidate that all query parameters are according to the OpenAPI specification\nValidate that all path parameters are according to the OpenAPI specification\nValidate that the content type of the request is according to the OpenAPI specification\nValidate that all cookies are according to the OpenAPI specification\nValidate that all HTTP headers are according to the OpenAPI specification\nValidate that the body is according to the OpenAPI specification\nValidate that the security schema is according to the OpenAPI specification\nValidate that the response code is according to the OpenAPI specification",
            "title": "OpenApiValidationProperties",
            "enum": [
                "PROPERTY_QUERY_PARAMETERS",
                "PROPERTY_PATH_PARAMETERS",
                "PROPERTY_CONTENT_TYPE",
                "PROPERTY_COOKIE_PARAMETERS",
                "PROPERTY_HTTP_HEADERS",
                "PROPERTY_HTTP_BODY",
                "PROPERTY_SECURITY_SCHEMA",
                "PROPERTY_RESPONSE_CODE"
            ],
            "default": "PROPERTY_QUERY_PARAMETERS",
            "x-displayname": "OpenAPI Validation Properties",
            "x-ves-proto-enum": "ves.io.schema.OpenApiValidationProperties"
        }
    },
    "x-displayname": "Application Security Monitoring APIs",
    "x-ves-proto-file": "ves.io/schema/app_security/public_oas_validation_api.proto"
}`
